import{_ as X,c as Z,o as r,l as m,u as o,p as C,d as I,t as c,I as se,ab as oe,ac as ne,s as D,b as s,ad as j,ae as re,$ as ie,j as le,x as ce,af as ue,y as de,i as V,w as t,F as w,ag as fe,a0 as pe,e as p,a2 as S,a3 as $,H as z,G as E,r as x,a as h,ah as B,ai as ge,J as W,aj as _e}from"./index.3ddb0175.js";import{B as me}from"./index.3b729402.js";import{a as ve,b as ke}from"./agent.238cb34e.js";import"./request.304a15fc.js";const he=a=>(oe("data-v-2562aa08"),a=a(),ne(),a),ye=he(()=>I("i",{class:"mdi-close mdi v-icon notranslate v-icon--size-small v-theme--light","aria-hidden":"true"},null,-1)),be=[ye],we={class:"v-alert__content"},Ce={name:"AlertNotify"},xe=Object.assign(Ce,{props:{type:{type:String,default:"info"},message:{type:String,default:""},closable:{type:Boolean,default:!0}},emits:["close"],setup(a,{emit:g}){const u=a,d=Z(()=>({type:u.type,message:u.message,closable:u.closable}));return(U,F)=>(r(),m("div",{class:se(`v-alert v-theme--light bg-${o(d).type} v-alert--density-default v-alert--variant-contained-flat alert-notify`)},[o(d).closable?(r(),m("div",{key:0,class:"v-alert__close",onClick:F[0]||(F[0]=v=>g("close"))},be)):C("v-if",!0),C(" alert body "),I("div",we,c(o(d).message),1)],2))}});var Ie=X(xe,[["__scopeId","data-v-2562aa08"],["__file","D:/tapp/ftma_app2/src/components/AlertNotify/index.vue"]]);const N=D(null),T=D(null);function Ae({type:a="info",message:g,timeout:u=5e3}){if(T.value)return;const d={type:a,message:g,onClose:Y};return T.value=s(Ie,d),j(T.value,document.body),re(()=>{N.value=setTimeout(()=>{j(null,document.body),N.value=null,T.value=null},u)}),Y}function Y(){j(null,document.body),clearTimeout(N.value),N.value=null,T.value=null}const G=D(!1),P=D(!0),M=D(),Ve=Z(()=>!G.value||!P.value);function Se(){G.value=ee(),J(),De()}function Te(){var a;return J(),Ve.value?(O("Camera permission is required for taking photos. Please turn on relevant permission"),M.value&&(M.value.value=""),!1):((a=M.value)==null||a.click(),!0)}function K(a){const u=a.target.files[0];if(J(),!P.value){O("Camera permission is required for taking photos. Please turn on relevant permission"),a.target.value="";return}if(!Pe(u)){O("Please take another picture"),a.target.value="";return}}function Pe(a){const g=Date.now(),u=5*60*1e3;return g-u<a.lastModified}function ee(){return window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)?"userAgentData"in navigator?navigator.userAgentData.mobile:!0:(O("Please use mobile browser to take photos"),!1)}function De(){window.addEventListener("resize",()=>{G.value=ee()})}function J(){var a;(a=navigator.mediaDevices)!=null&&a.getUserMedia||(navigator.mediaDevices={},navigator.mediaDevices.getUserMedia=g=>{const u=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return u?new Promise((d,U)=>{u.call(navigator,g,d,U)}):(P.value=!te(),Promise.reject(new Error("Your browser does not support accessing user media devices")))}),Ue({video:!0,audio:!1})}function Ue(a){navigator.mediaDevices.getUserMedia(a).then(()=>{P.value=!0}).catch(g=>{P.value=!te()})}function te(){return!!location.protocol.match(/https:/i)}function O(a){Ae({type:"error",message:a})}const Fe=p("mdi-map-marker-radius"),$e=p(" Completed "),Be=p(" Completed "),Me=p("Visit History"),Ne={class:"font-weight-normal"},Oe={name:"AgentView"},ze=Object.assign(Oe,{setup(a){const g=ie(),u=le(),d=ce({loading:!1,selection:1,agentVisits:{visits:[]},agentTasksActions:{actionsFilter:[],actions:[],tasksFilter:[],tasks:[]},agentInfo:null}),{loading:U,agentVisits:F,agentTasksActions:v,agentInfo:y}=ue(d);de(async()=>{Se();try{d.loading=!0;const n=await ve(g.params.id);d.agentTasksActions=ae(n.agentTasksActions),d.agentVisits=n.agentVisits,d.agentInfo=n.agentInfo}catch(n){console.log(n)}finally{d.loading=!1}});function ae(n){const A=JSON.parse(JSON.stringify(n)),_={actionsFilter:[],actions:[],tasksFilter:[],tasks:[]};A.actions.forEach(l=>i(l,"actionsFilter","actions")),A.tasks.forEach(l=>i(l,"tasksFilter","tasks")),f("actionsFilter"),f("tasksFilter");function i(l,k,e){Reflect.has(l,"priority")?_[k].push(l):_[e].push(l)}function f(l,k="<"){_[l]=_[l].sort((e,b)=>{const H=e.priority.replace(/^A/,""),Q=b.priority.replace(/^A/,"");return k==="<"?H-Q:Q-H})}return _}function R(n){q(n),u.push({name:"TaskDetail",params:{id:n.taskId}})}async function L(n){if(n.category==="store-front-photo"){if(!Te())return;const i=await ke(n.actionId);console.log(`url ==> ${i}`);return}q(n),u.push({name:"TaskDetail",params:{id:n.actionId}})}function q(n){n={mode:"response",category:n.category,id:n.taskId||n.actionId},sessionStorage.setItem("item",JSON.stringify(n))}return(n,A)=>(r(),m(w,null,[s(me,{color:"green"}),s(V,{loading:o(U)},{progress:t(()=>[s(fe,{color:"deep-purple",height:"10",indeterminate:""})]),default:t(()=>{var _;return[s(pe,{class:"white--text align-end",cover:"",height:"250",src:(_=o(y))==null?void 0:_.store_front_photo},{default:t(()=>[s(S,{class:"text-white"},{default:t(()=>{var i;return[p(c((i=o(y))==null?void 0:i.business_name),1)]}),_:1})]),_:1},8,["src"]),s($,null,{default:t(()=>{var i,f,l,k,e,b;return[s(E,{variant:"text",icon:"",color:"green darken-2",href:`https://maps.google.com/maps?q=${(i=o(y))==null?void 0:i.store_location.lat},${(f=o(y))==null?void 0:f.store_location.long}`,target:"_blank"},{default:t(()=>[s(z,null,{default:t(()=>[Fe]),_:1})]),_:1},8,["href"]),I("span",null,c((l=o(y))==null?void 0:l.business_regency)+"/"+c((k=o(y))==null?void 0:k.business_district)+"/"+c((e=o(y))==null?void 0:e.business_village)+", "+c((b=o(y))==null?void 0:b.store_type),1)]}),_:1}),s($,null,{default:t(()=>{var i,f,l,k;return[((i=o(v).tasksFilter)==null?void 0:i.length)>0?(r(!0),m(w,{key:0},x(o(v).tasksFilter,e=>(r(),h(V,{class:"ma-1 mp-0",key:e.taskId,color:e.color,dark:"",onClick:b=>R(e)},{default:t(()=>[s(S,{class:"pb-0 text-white"},{default:t(()=>[p(c(e.category.toUpperCase()),1)]),_:2},1024),s(B,{class:"pb-3 text-white"},{default:t(()=>[p("DUE: "+c(e.dueAt),1)]),_:2},1024)]),_:2},1032,["color","onClick"]))),128)):C("v-if",!0),((f=o(v).actionsFilter)==null?void 0:f.length)>0?(r(!0),m(w,{key:1},x(o(v).actionsFilter,e=>(r(),h(V,{key:e.actionId,class:"ma-1 mp-0 py-2",color:e.color,dark:"",onClick:b=>L(e)},{default:t(()=>[s(S,{class:"pb-0 text-white"},{default:t(()=>[p(c(e.category.toUpperCase()),1)]),_:2},1024),s(B,{class:"pb-3 text-white"},{default:t(()=>[p(c(e.description),1)]),_:2},1024),e.completed?(r(),h(E,{key:0,class:"ma-2",color:"primary"},{default:t(()=>[$e,s(z,{end:"",icon:"mdi-checkbox-marked-circle"})]),_:1})):C("v-if",!0)]),_:2},1032,["color","onClick"]))),128)):C("v-if",!0),((l=o(v).tasks)==null?void 0:l.length)>0?(r(!0),m(w,{key:2},x(o(v).tasks,e=>(r(),h(V,{class:"ma-1 mp-0",key:e.taskId,color:e.color,dark:"",onClick:b=>R(e)},{default:t(()=>[s(S,{class:"pb-0 text-white"},{default:t(()=>[p(c(e.category.toUpperCase()),1)]),_:2},1024),s(B,{class:"pb-3 text-white"},{default:t(()=>[p("DUE: "+c(e.dueAt),1)]),_:2},1024)]),_:2},1032,["color","onClick"]))),128)):C("v-if",!0),((k=o(v).actions)==null?void 0:k.length)>0?(r(!0),m(w,{key:3},x(o(v).actions,e=>(r(),h(V,{key:e.actionId,class:"ma-1 mp-0 py-2",color:e.color,dark:"",onClick:b=>L(e)},{default:t(()=>[s(S,{class:"pb-0 text-white"},{default:t(()=>[p(c(e.category.toUpperCase()),1)]),_:2},1024),s(B,{class:"pb-3 text-white"},{default:t(()=>[p(c(e.description),1)]),_:2},1024),e.completed?(r(),h(E,{key:0,class:"ma-2",color:"primary"},{default:t(()=>[Be,s(z,{end:"",icon:"mdi-checkbox-marked-circle"})]),_:1})):C("v-if",!0)]),_:2},1032,["color","onClick"]))),128)):C("v-if",!0)]}),_:1}),s($,null,{default:t(()=>[s(V,null,{default:t(()=>[s(S,null,{default:t(()=>[Me]),_:1}),s($,null,{default:t(()=>[s(ge,{align:"top",density:"compact"},{default:t(()=>[(r(!0),m(w,null,x(o(F).visits,i=>(r(),h(_e,{key:i.visitedAt,size:"10","fill-dot":"","dot-color":"info"},{default:t(()=>[I("div",null,[I("div",Ne,[I("strong",null,"@"+c(i.visitedAt),1)]),(r(!0),m(w,null,x(i.tasks,f=>(r(),h(W,{label:"",variant:"outlined",class:"ma-1",key:f,size:"small",text:f},null,8,["text"]))),128)),(r(!0),m(w,null,x(i.actions,f=>(r(),h(W,{label:"",variant:"outlined",class:"ma-1",key:f,size:"small"},{default:t(()=>[p(c(f),1)]),_:2},1024))),128))])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]}),_:1},8,["loading"]),I("input",{hidden:"",ref_key:"uploader",ref:M,type:"file",accept:"image/*",capture:"camera",onChange:A[0]||(A[0]=(..._)=>o(K)&&o(K)(..._))},null,544)],64))}});var Re=X(ze,[["__file","D:/tapp/ftma_app2/src/views/Agent/view.vue"]]);export{Re as default};
